<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login - Snackify</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">

  <div class="card text-center shadow p-3 position-absolute top-50 start-50 translate-middle" style="width: 25rem;">
    <div class="card-header fw-bold fs-4">
      Entrar
    </div>
    <div class="card-body">
      <div class="form-floating mb-3">
        <input type="email" class="form-control" id="email" placeholder="name@example.com" />
        <label for="email">Email</label>
      </div>

      <div class="form-floating mb-3">
        <input type="password" class="form-control" id="password" placeholder="Senha" />
        <label for="password">Senha</label>
      </div>

      <button id="loginBtn" class="btn btn-primary w-100 mb-2">Entrar</button>
      <button id="registerLink" class="btn btn-outline-success w-100">Criar conta</button>

      <div id="alertBox" class="mt-3" style="display:none;"></div>
    </div>
  </div>

  <script type="module">
    // Importando o Firebase e configurando o app
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    // Configuração do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBXUsCsHpebP8-S1gUFvqx1dyvJ5878M9g",
      authDomain: "snackify-bec06.firebaseapp.com",
      projectId: "snackify-bec06",
      storageBucket: "snackify-bec06.firebasestorage.app",
      messagingSenderId: "452200530393",
      appId: "1:452200530393:web:af3e09bae8735f2b2199c8",
      measurementId: "G-NMXJ9S4V8L"
    };

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // Selecionando os elementos do DOM
    const loginBtn = document.getElementById("loginBtn");
    const registerLink = document.getElementById("registerLink");
    const email = document.getElementById("email");
    const password = document.getElementById("password");
    const alertBox = document.getElementById("alertBox");

    // Função para exibir alertas
    function showAlert(msg, type = "danger") {
      alertBox.style.display = "block";
      alertBox.innerHTML = `
        <div class="alert alert-${type} alert-dismissible fade show" role="alert">
          ${msg}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>`;
    }

    // Evento de clique para login
    loginBtn.addEventListener("click", async () => {
      const mail = email.value.trim();
      const pass = password.value.trim();

      if (!mail || !pass) {
        showAlert("Preencha todos os campos!", "warning");
        return;
      }

      try {
        const userCredential = await signInWithEmailAndPassword(auth, mail, pass);
        const user = userCredential.user;
        showAlert(`Bem-vindo, ${user.displayName || "usuário"}!`, "success");
        setTimeout(() => window.location.href = "index.html", 1500);
      } catch (e) {
        console.error("Erro ao entrar:", e); // Exibe o erro no console
        showAlert("Erro ao entrar: " + e.message, "danger");
      }
    });

    // Evento de clique para redirecionar ao registro
    registerLink.addEventListener("click", () => {
      window.location.href = "register.html"; // Caminho corrigido para o arquivo de registro
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>