<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SNACKIFY</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
<style>
/* Estilos Essenciais para o Layout */
body { margin:0; padding:0; display:flex; flex-direction:column; min-height:100vh; }
main { flex:1 0 auto; padding-bottom:30px; } 

/* Estilos para o Card e BotÃ£o Admin */
.product-card { position:relative; cursor:pointer; }
.edit-btn { position:absolute; top:5px; right:5px; display:flex; gap:5px; }
.product-image { width: 100%; height: 150px; object-fit: cover; border-bottom: 1px solid #eee; }
.product-image-placeholder {
Â  width: 100%; height: 150px; background-color: #f8f9fa; border-bottom: 1px solid #eee;
Â  display: flex; justify-content: center; align-items: center; font-size: 3rem; color: #6c757d;
}
.product-image-placeholder.salgadinho { background-color: #ffeeba; }
.product-image-placeholder.bebida { background-color: #add8e6; }

/* --- FOOTER (NÃ£o Fixo) --- */
footer { 
    flex-shrink:0; 
    background-color: #f8f9fa;
    border-top: 1px solid #e9ecef;
    padding: 20px 0;
}
.footer-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
}
.footer-text {
    font-size: 0.9rem;
    color: #6c757d;
}

/* --- ESTILIZAÃ‡ÃƒO MELHORADA DO CARRINHO --- */
/* Estilo do item de carrinho */
#cartItems .list-group-item { 
    padding: 12px 15px; 
    border-left: none; 
    border-right: none;
    border-color: #eee;
}
#cartItems .list-group-item:first-child { border-top: none; }
#cartItems .list-group-item:last-child { border-bottom: none; }

/* BotÃ£o de Remover (Lixeira) */
#cartItems .btn-remover { 
    background: none; border: none; color: #dc3545; padding: 0; font-size: 1.1rem; line-height: 1; transition: color 0.2s; 
}
#cartItems .btn-remover:hover { color: #a30018; }

/* Estilo para o grupo de controle de quantidade */
#cartItems .controle-quantidade { display: flex; align-items: center; gap: 0; }

/* BotÃµes de Mais/Menos (Minimalista) */
#cartItems .btn-quantidade {
    width: 28px; /* Ligeiramente menor */
    height: 28px;
    padding: 0; 
    border-radius: 50% !important; 
    border: 1px solid #007bff;
    background-color: transparent; 
    color: #007bff;
    font-size: 1rem;
    line-height: 1;
    display: flex; justify-content: center; align-items: center;
}
#cartItems .btn-quantidade:hover { background-color: #007bff; color: white; }
/* Campo de quantidade */
#cartItems .quantidade-display { padding: 0 8px; font-weight: bold; font-size: 0.9rem; min-width: 30px; text-align: center; }

/* TÃ­tulo e Total no Offcanvas */
.offcanvas-header { border-bottom: 1px solid #eee; }
.offcanvas-title { font-weight: bold; }
.offcanvas-total-fixed { 
    font-size: 1.25rem; 
    font-weight: bold; 
    color: #007bff; 
}
</style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom sticky-top">
Â  <div class="container">
Â  Â  <a class="navbar-brand fw-bold" href="#">SNACKIFY</a>
Â  Â  <div class="d-flex align-items-center">
Â  Â  Â  <span id="loginStatus" class="me-3 text-muted d-none d-sm-inline"></span>
Â  Â  Â  <button id="loginLogoutBtn" class="btn btn-outline-primary btn-sm me-2">Login</button>
Â  Â  Â  
Â  Â  Â  Â  Â  Â  <button id="cartButton" class="btn btn-success btn-sm position-relative">
Â  Â  Â  Â  <i class="bi bi-cart"></i>
Â  Â  Â  Â  <span id="cartBadge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="font-size: 0.6em; padding: 3px 6px;">0</span>
Â  Â  Â  </button>
Â  Â  </div>
Â  </div>
</nav>

<header class="py-5 text-center">
Â  <div class="container">
Â  Â  <h1 class="display-6">PeÃ§a seus snacks e bebidas pelo WhatsApp</h1>
Â  Â  <p class="text-muted mt-2">Cheetos, Ruffles, Doritos, Fandangos, KrÃ³, Coca-Cola, Fanta, GuaranÃ¡, Sprite e muito mais.</p>
Â  Â  <button id="addProductBtn" class="btn btn-success btn-sm d-none mt-3">+ Adicionar Produto</button>
Â  </div>
</header>

<main class="container mb-5">
Â  <section class="mb-5">
Â  Â  <h2 class="h4 mb-3">Salgadinhos</h2>
Â  Â  <div id="salgadinhosGrid" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-3">
Â  Â  Â  </div>
Â  </section>
Â  <section>
Â  Â  <h2 class="h4 mb-3">Bebidas</h2>
Â  Â  <div id="bebidasGrid" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-3"></div>
Â  </section>
</main>

<div class="modal fade" id="productModal" tabindex="-1">
Â  <div class="modal-dialog">
Â  Â  <div class="modal-content">
Â  Â  Â  <div class="modal-header">
Â  Â  Â  Â  <h5 class="modal-title">Adicionar/Editar Produto</h5>
Â  Â  Â  Â  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
Â  Â  Â  Â  </div>
Â  Â  Â  <div class="modal-body">
Â  Â  Â  Â  <form id="productForm">
Â  Â  Â  Â  Â  <input type="hidden" id="productId">
Â  Â  Â  Â  Â  <div class="mb-3">
Â  Â  Â  Â  Â  Â  <label for="productName" class="form-label">Nome</label>
Â  Â  Â  Â  Â  Â  <input type="text" class="form-control" id="productName" required>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="mb-3">
Â  Â  Â  Â  Â  Â  <label for="productPrice" class="form-label">PreÃ§o</label>
Â  Â  Â  Â  Â  Â  <input type="number" class="form-control" id="productPrice" required>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="mb-3">
Â  Â  Â  Â  Â  Â  <label for="productCategory" class="form-label">Categoria</label>
Â  Â  Â  Â  Â  Â  <select class="form-select" id="productCategory" multiple required>
Â  Â  Â  Â  Â  Â  Â  <option value="Salgadinho">Salgadinho</option>
Â  Â  Â  Â  Â  Â  Â  <option value="Bebida">Bebida</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="mb-3">
Â  Â  Â  Â  Â  Â  <label for="productSizes" class="form-label">Tamanhos (P,M,G)</label>
Â  Â  Â  Â  Â  Â  <input type="text" class="form-control" id="productSizes" value="P,M,G" required>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="mb-3">
Â  Â  Â  Â  Â  Â  <label for="productImage" class="form-label">URL da Imagem (Opcional)</label>
Â  Â  Â  Â  Â  Â  <input type="url" class="form-control" id="productImage">
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </form>
Â  Â  Â  </div>
Â  Â  Â  <div class="modal-footer">
Â  Â  Â  Â  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
Â  Â  Â  Â  <button type="button" class="btn btn-primary" id="saveProductBtn">Salvar</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>
</div>

<div class="modal fade" id="loginModal" tabindex="-1">
Â  <div class="modal-dialog">
Â  Â  <div class="modal-content">
Â  Â  Â  <div class="modal-header">
Â  Â  Â  Â  <h5 class="modal-title">Login</h5>
Â  Â  Â  Â  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
Â  Â  Â  </div>
Â  Â  Â  <div class="modal-body">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-floating mb-3">
Â  Â  Â  Â  Â  <input type="email" class="form-control" id="loginEmail" placeholder="name@example.com" />
Â  Â  Â  Â  Â  <label for="loginEmail">Email</label>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-floating mb-3">
Â  Â  Â  Â  Â  <input type="password" class="form-control" id="loginPassword" placeholder="Senha" />
Â  Â  Â  Â  Â  <label for="loginPassword">Senha</label>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="loginAlert" style="display:none;"></div>
Â  Â  Â  Â  <button class="btn btn-primary w-100 mt-2" id="loginSubmitBtn">Entrar</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>
</div>

<div class="offcanvas offcanvas-end" tabindex="-1" id="cartOffcanvas">
Â  <div class="offcanvas-header">
Â  Â  <h5 class="offcanvas-title">Seu Carrinho</h5>
Â  Â  <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
Â  </div>
Â  <div class="offcanvas-body d-flex flex-column p-0">
    <div id="cartItems" class="list-group flex-grow-1 overflow-auto">
        </div>

    Â  Â  <div class="p-3 border-top bg-light">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <span class="fs-5 fw-bold">Total:</span>
            <span id="cartTotal" class="offcanvas-total-fixed">R$ 0,00</span>
        </div>
Â  Â  Â  <div class="d-grid gap-2">
Â  Â  Â  Â  <button id="checkoutBtn" class="btn btn-success btn-lg">
            <i class="bi bi-whatsapp me-2"></i> Finalizar Pedido
        </button>
Â  Â  Â  Â  <button id="clearCartBtn" class="btn btn-outline-secondary btn-sm">Limpar Carrinho</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>
</div>

<footer>
Â  <div class="container footer-content">
Â  Â  <div class="footer-text">
Â  Â  Â  &copy; 2024 SNACKIFY. Todos os direitos reservados.
Â  Â  </div>
Â  Â  <a id="quickWhatsBtn" class="btn btn-success btn-sm mt-2 mt-sm-0" href="#" target="_blank">
        <i class="bi bi-whatsapp me-1"></i> Pedir pelo WhatsApp
    </a>
Â  </div>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

const firebaseConfig = {
Â  apiKey: "AIzaSyDmmt1wbET6-dcvdsBGXW9j8Pm-S9N4kcs",
Â  authDomain: "lerning-project-4762d.firebaseapp.com",
Â  projectId: "lerning-project-4762d",
Â  storageBucket: "lerning-project-4762d.appspot.com",
Â  messagingSenderId: "45818309485",
Â  appId: "1:45818309485:web:e5ef5b9532c6e7d2754864",
Â  measurementId: "G-6HR53JJSW4"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

let isLoggedIn = false;
let currentUserId = null;
let cart = [];

const loginStatus = document.getElementById("loginStatus");
const loginLogoutBtn = document.getElementById("loginLogoutBtn");
const addProductBtn = document.getElementById("addProductBtn");
const cartButton = document.getElementById("cartButton");
const cartBadge = document.getElementById("cartBadge");

// ConfiguraÃ§Ã£o do Offcanvas para PERMITIR A ROLAGEM da pÃ¡gina principal
const cartOffcanvas = new bootstrap.Offcanvas(document.getElementById("cartOffcanvas"), {
    backdrop: false,
    scroll: true
});

const loginModal = new bootstrap.Modal(document.getElementById("loginModal"));
const productModal = new bootstrap.Modal(document.getElementById("productModal"));

const loginEmail = document.getElementById("loginEmail");
const loginPassword = document.getElementById("loginPassword");
const loginSubmitBtn = document.getElementById("loginSubmitBtn");
const loginAlert = document.getElementById("loginAlert");

const salgadinhosGrid = document.getElementById("salgadinhosGrid");
const bebidasGrid = document.getElementById("bebidasGrid");


// --- FunÃ§Ãµes Auxiliares ---

function showLoginAlert(msg, type="danger"){
Â  loginAlert.style.display="block";
Â  loginAlert.innerHTML=`<div class="alert alert-${type} alert-dismissible fade show">${msg}<button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>`;
}

function updateLoginStatus(){
Â  if(isLoggedIn){
Â  Â  loginStatus.textContent="VocÃª estÃ¡ logado.";
Â  Â  loginLogoutBtn.textContent="Logout";
Â  Â  loginLogoutBtn.classList.replace("btn-outline-primary","btn-outline-danger");
Â  Â  addProductBtn.classList.remove("d-none");
Â  Â  loginLogoutBtn.onclick = ()=>{ signOut(auth).then(()=>{ isLoggedIn=false; currentUserId=null; updateLoginStatus(); loadProducts(); renderCart(); }); };
Â  } else {
Â  Â  loginStatus.textContent="VocÃª nÃ£o estÃ¡ logado.";
Â  Â  loginLogoutBtn.textContent="Login";
Â  Â  loginLogoutBtn.classList.replace("btn-outline-danger","btn-outline-primary");
Â  Â  addProductBtn.classList.add("d-none");
Â  Â  loginLogoutBtn.onclick = ()=>{ loginModal.show(); };
Â  }
}

function mudarQuantidade(produtoId, acao) {
    const itemIndex = cart.findIndex(p => p.id === produtoId);

    if (itemIndex > -1) {
        if (acao === 'aumentar') {
            cart[itemIndex].quantidade += 1;
        } else if (acao === 'diminuir') {
            if (cart[itemIndex].quantidade > 1) {
                cart[itemIndex].quantidade -= 1;
            } else {
                cart.splice(itemIndex, 1);
            }
        } else if (acao === 'remover') {
            cart.splice(itemIndex, 1);
        }
    }
    renderCart();
}

// FunÃ§Ã£o para renderizar o carrinho (com visual minimalista)
function renderCart(){
    const cartItems = document.getElementById("cartItems");
    cartItems.innerHTML="";
    
    let total = 0;
    let totalItens = 0; 
    
    if (cart.length === 0) {
        cartItems.innerHTML = '<div class="p-3 text-center text-muted">O carrinho estÃ¡ vazio. Adicione alguns produtos!</div>';
    } else {
        cart.forEach((p) => {
            const precoUnitario = p.preco || 0;
            const quantidade = p.quantidade || 1;
            const subtotal = precoUnitario * quantidade;
            
            total += subtotal;
            totalItens += quantidade;

            const item = document.createElement("div");
            item.className = "list-group-item d-flex flex-column";
            item.innerHTML = `
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="fw-bold">${p.nome}</div>
                        <small class="text-muted">R$ ${precoUnitario.toFixed(2)} un. | Subtotal: R$ ${subtotal.toFixed(2)}</small>
                    </div>
                    <button class="btn-remover ms-2" data-id="${p.id}" title="Remover item do carrinho">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
                
                <div class="mt-2 d-flex justify-content-end">
                    <div class="controle-quantidade">
                        <button type="button" class="btn-quantidade btn-diminuir" data-id="${p.id}">
                            <i class="bi bi-dash"></i>
                        </button>
                        <span class="quantidade-display">${quantidade}</span>
                        <button type="button" class="btn-quantidade btn-aumentar" data-id="${p.id}">
                            <i class="bi bi-plus"></i>
                        </button>
                    </div>
                </div>
            `;

            item.querySelector(".btn-diminuir").onclick = () => mudarQuantidade(p.id, 'diminuir');
            item.querySelector(".btn-aumentar").onclick = () => mudarQuantidade(p.id, 'aumentar');
            item.querySelector(".btn-remover").onclick = () => mudarQuantidade(p.id, 'remover');

            cartItems.appendChild(item);
        });
    }
    
    // Atualiza o total no rodapÃ© do offcanvas
    document.getElementById("cartTotal").textContent = `R$ ${total.toFixed(2)}`;
    cartBadge.textContent = totalItens;
}


/**
Â * FunÃ§Ã£o para criar o card de produto.
Â */
function createProductCard(p) {
Â  const col=document.createElement("div"); col.className="col";
Â  const card=document.createElement("div"); card.className="card h-100 product-card shadow-sm";
Â  
Â  if (p.imagemUrl) {
Â  Â  const img = document.createElement("img");
Â  Â  img.src = p.imagemUrl;
Â  Â  img.className = "card-img-top product-image";
Â  Â  img.alt = p.nome;
Â  Â  card.appendChild(img);
Â  } else {
Â  Â  let iconClass = '';
Â  Â  let placeholderClass = '';
Â  Â  const categoriasDoProduto = Array.isArray(p.Categoria) ? p.Categoria : (typeof p.Categoria === 'string' ? [p.Categoria] : []);

Â  Â  if (categoriasDoProduto.includes("Bebida")) {
Â  Â  Â  iconClass = "bi-cup-fill";
Â  Â  Â  placeholderClass = "bebida";
Â  Â  } else if (categoriasDoProduto.includes("Salgadinho")) {
Â  Â  Â  iconClass = "bi-bag-fill";
Â  Â  Â  placeholderClass = "salgadinho";
Â  Â  } else {
Â  Â  Â  Â  iconClass = "bi-question-circle-fill";
Â  Â  Â  Â  placeholderClass = "default";
Â  Â  }

Â  Â  const placeholderDiv = document.createElement("div");
Â  Â  placeholderDiv.className = `product-image-placeholder ${placeholderClass}`;
Â  Â  const icon = document.createElement("i");
Â  Â  icon.className = `bi ${iconClass}`;
Â  Â  placeholderDiv.appendChild(icon);
Â  Â  card.appendChild(placeholderDiv);
Â  }

Â  const body=document.createElement("div"); body.className="card-body d-flex flex-column";
Â  const title=document.createElement("h5"); title.className="card-title"; title.textContent=p.nome;
Â  const info=document.createElement("div"); info.className="text-muted mb-2"; 
Â  
Â  const tamanhosArray = Array.isArray(p.tamanhos) ? p.tamanhos : (typeof p.tamanhos === 'string' ? p.tamanhos.split(',') : ['P','M','G']);
Â  info.textContent="Tamanho: "+tamanhosArray.join(",");
Â  
Â  const footer=document.createElement("div"); footer.className="mt-auto d-flex flex-column align-items-start";
Â  const priceSpan=document.createElement("span"); priceSpan.textContent=`R$ ${(p.preco||0).toFixed(2)}`;
Â  const editDiv=document.createElement("div"); editDiv.className="edit-btn";

Â  if(isLoggedIn){
Â  Â  const editBtn=document.createElement("button"); editBtn.className="btn btn-sm btn-primary"; editBtn.textContent="âœŽ";
Â  Â  editBtn.onclick=()=>{
Â  Â  Â  document.getElementById("productId").value=p.id;
Â  Â  Â  document.getElementById("productName").value=p.nome;
Â  Â  Â  document.getElementById("productPrice").value=p.preco;
Â  Â  Â  
Â  Â  Â  const categoriasDoProduto = Array.isArray(p.Categoria) ? p.Categoria : (typeof p.Categoria === 'string' ? [p.Categoria] : []);
Â  Â  Â  Array.from(document.getElementById("productCategory").options).forEach(option => {
Â  Â  Â  Â  option.selected = categoriasDoProduto.includes(option.value);
Â  Â  Â  });
Â  Â  Â  document.getElementById("productSizes").value=tamanhosArray.join(",");
Â  Â  Â  document.getElementById("productImage").value=p.imagemUrl || '';
Â  Â  Â  productModal.show();
Â  Â  };
Â  Â  const delBtn=document.createElement("button"); delBtn.className="btn btn-sm btn-danger"; delBtn.textContent="ðŸ—‘";
Â  Â  delBtn.onclick=async()=>{
Â  Â  Â  if(confirm(`Tem certeza que deseja deletar o produto ${p.nome}?`)){
Â  Â  Â  Â  await deleteDoc(doc(db,"produtos",p.id)); 
Â  Â  Â  Â  loadProducts();
Â  Â  Â  }
Â  Â  };
Â  Â  editDiv.append(editBtn, delBtn);
Â  Â  card.appendChild(editDiv);
Â  } else {
Â  Â  const addBtn=document.createElement("button");
Â  Â  addBtn.className="btn btn-success btn-sm mt-2";
Â  Â  addBtn.textContent="+ Adicionar ao carrinho";
Â  Â  addBtn.onclick=(e)=>{ 
Â  Â  Â  e.stopPropagation(); 
Â  Â  Â  
Â  Â  Â  const itemNoCarrinho = cart.find(item => item.id === p.id);
Â  Â  Â  
Â  Â  Â  if (itemNoCarrinho) {
Â  Â  Â  Â  itemNoCarrinho.quantidade += 1;
Â  Â  Â  } else {
Â  Â  Â  Â  cart.push({
Â  Â  Â  Â  Â  id: p.id, 
Â  Â  Â  Â  Â  nome: p.nome, 
Â  Â  Â  Â  Â  preco: p.preco,
Â  Â  Â  Â  Â  quantidade: 1
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  renderCart(); 
Â  Â  Â  cartOffcanvas.show();
Â  Â  };
Â  Â  footer.appendChild(addBtn);
Â  }

Â  footer.appendChild(priceSpan);
Â  body.append(title,info,footer);
Â  card.appendChild(body);
Â  col.appendChild(card);
Â  return col;
}

// --- LÃ³gica Principal de Carregamento ---

async function loadProducts(){
Â  salgadinhosGrid.innerHTML="";
Â  bebidasGrid.innerHTML="";
Â  
Â  try{
Â  Â  const snapshot = await getDocs(collection(db,"produtos"));
Â  Â  snapshot.forEach(docSnap=>{
Â  Â  Â  const p={id:docSnap.id, ...docSnap.data()};
Â  Â  Â  
Â  Â  Â  let categorias = Array.isArray(p.Categoria) ? p.Categoria : (typeof p.Categoria === 'string' ? [p.Categoria] : []);
Â  Â  Â  
Â  Â  Â  if(categorias.length > 0){
Â  Â  Â  Â  
Â  Â  Â  Â  if(categorias.includes("Salgadinho")) {
Â  Â  Â  Â  Â  salgadinhosGrid.appendChild(createProductCard(p));
Â  Â  Â  Â  }
Â  Â  Â  Â  if(categorias.includes("Bebida")) {
Â  Â  Â  Â  Â  bebidasGrid.appendChild(createProductCard(p));
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  });
Â  } catch(e){ console.error("Erro ao carregar produtos:", e); }
}

// --- Event Listeners ---

document.getElementById("clearCartBtn").addEventListener("click", ()=>{ cart=[]; renderCart(); });

// NÃšMERO DE WHATSAPP FIXADO: 5584999568739
const NUMERO_WHATSAPP = "5584999568739";

document.getElementById("checkoutBtn").addEventListener("click", ()=>{
Â  if(cart.length===0){ alert("Carrinho vazio!"); return; }
Â  let message="OlÃ¡, quero pedir:\n";
Â  cart.forEach((p,i)=>{ 
    const subtotal = (p.preco || 0) * (p.quantidade || 1);
    message+=`${i+1}. ${p.quantidade}x ${p.nome} (Subtotal: R$ ${subtotal.toFixed(2)})\n`; 
  });
Â  const total=cart.reduce((a,b)=>a+((b.preco||0)*(b.quantidade||1)),0);
Â  message+=`\nTotal: R$ ${total.toFixed(2)}`;

  window.open(`https://wa.me/${NUMERO_WHATSAPP}?text=${encodeURIComponent(message)}`,"_blank");
});

// AÃ§Ãµes para o botÃ£o do WhatsApp no footer
document.getElementById("quickWhatsBtn").addEventListener("click", (e) => {
    e.preventDefault();
    const mensagemInicial = "OlÃ¡, gostaria de fazer um pedido na SNACKIFY!";
    window.open(`https://wa.me/${NUMERO_WHATSAPP}?text=${encodeURIComponent(mensagemInicial)}`, "_blank");
});

cartButton.addEventListener("click", ()=>{ cartOffcanvas.show(); });

addProductBtn.onclick=()=>{ 
Â  document.getElementById("productForm").reset();
Â  document.getElementById("productId").value = '';
Â  Array.from(document.getElementById("productCategory").options).forEach(option => option.selected = false);
Â  document.getElementById("productSizes").value="P,M,G"; 
Â  document.getElementById("productImage").value='';
Â  productModal.show(); 
};

document.getElementById("saveProductBtn").onclick=async()=>{
Â  const id=document.getElementById("productId").value;
Â  const nome=document.getElementById("productName").value;
Â  const preco=parseFloat(document.getElementById("productPrice").value);
Â  const categorias=Array.from(document.getElementById("productCategory").selectedOptions).map(o=>o.value); 
Â  const tamanhos=document.getElementById("productSizes").value.split(",").map(t=>t.trim()).filter(t=>t);
Â  const imagemUrl=document.getElementById("productImage").value.trim();
Â  
Â  if(!nome||isNaN(preco)||categorias.length===0){ alert("Preencha todos os campos corretamente"); return; }
Â  
Â  try{
Â  Â  const data = {nome, preco, Categoria:categorias, tamanhos, imagemUrl: imagemUrl || null};
Â  Â  if(id){ await updateDoc(doc(db,"produtos",id),data); }
Â  Â  else{ await addDoc(collection(db,"produtos"),data); }
Â  Â  productModal.hide();
Â  Â  loadProducts();
Â  } catch(e){ alert("Erro ao salvar produto: "+e.message); }
};

loginSubmitBtn.onclick = async () => {
Â  const mail = loginEmail.value.trim();
Â  const pass = loginPassword.value.trim();
Â  if (!mail || !pass) { showLoginAlert("Preencha todos os campos!", "warning"); return; }

Â  try {
Â  Â  const userCredential = await signInWithEmailAndPassword(auth, mail, pass);
Â  Â  console.log("Login ok:", userCredential.user);
Â  Â  loginModal.hide();
Â  Â  loginEmail.value = '';
Â  Â  loginPassword.value = '';
Â  Â  loginAlert.style.display = "none";
Â  } catch (e) {
Â  Â  console.error("Erro no signIn:", e, "code:", e.code, "message:", e.message);

Â  Â  let friendly = "Erro ao tentar entrar. Verifique seu email e senha.";
Â  Â  if (e.code === "auth/invalid-email") friendly = "Email invÃ¡lido. Verifique o formato do email.";
Â  Â  else if (e.code === "auth/user-not-found") friendly = "Conta nÃ£o encontrada. Verifique o email ou crie uma conta.";
Â  Â  else if (e.code === "auth/wrong-password") friendly = "Senha incorreta.";
Â  Â  else if (e.code === "auth/too-many-requests") friendly = "Muitas tentativas. Tente novamente mais tarde.";
Â  Â  else if (e.code === "auth/network-request-failed") friendly = "Erro de rede. Verifique sua conexÃ£o.";
Â  Â  else if (e.code === "auth/operation-not-allowed") friendly = "MÃ©todo de login nÃ£o permitido. Ative Email/Password no Firebase.";
Â  Â  else if (e.code === "auth/invalid" || e.code === "auth/invalid-credential") friendly = "Credenciais invÃ¡lidas. Verifique a configuraÃ§Ã£o do Firebase.";

Â  Â  showLoginAlert(friendly, "danger");
Â  }
};

onAuthStateChanged(auth, user => {
Â  isLoggedIn = !!user;
Â  currentUserId = user?.uid || null;

Â  if (isLoggedIn) {
Â  Â  addProductBtn.classList.remove("d-none");
Â  } else {
Â  Â  addProductBtn.classList.add("d-none");
Â  }

Â  updateLoginStatus();
Â  loadProducts();
Â  renderCart();
});

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
