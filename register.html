<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registrar - Snackify</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">

  <div class="card text-center shadow p-3 position-absolute top-50 start-50 translate-middle" style="width: 25rem;">
    <div class="card-header fw-bold fs-4">
      Criar Conta
    </div>
    <div class="card-body">
      <div class="form-floating mb-3">
        <input type="text" class="form-control" id="fullName" placeholder="Seu nome completo" />
        <label for="fullName">Nome completo</label>
      </div>

      <div class="form-floating mb-3">
        <input type="email" class="form-control" id="email" placeholder="name@example.com" />
        <label for="email">Email</label>
      </div>

      <div class="form-floating mb-3">
        <input type="password" class="form-control" id="password" placeholder="Senha" />
        <label for="password">Senha</label>
      </div>

      <div class="form-floating mb-3">
        <input type="password" class="form-control" id="confirmPassword" placeholder="Confirme a senha" />
        <label for="confirmPassword">Confirme a senha</label>
      </div>

      <button id="registerBtn" class="btn btn-success w-100 mb-2">Registrar</button>
      <button id="backBtn" class="btn btn-outline-secondary w-100">Voltar</button>

      <div id="alertBox" class="mt-3" style="display:none;"></div>
    </div>
  </div>

  <script type="module">
    // Importando o Firebase e configurando o app
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { addDoc, collection } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    addDoc(collection(db, "logs_acessos"), {
      timestamp: new Date(),
      userId: auth.currentUser ? auth.currentUser.uid : null,
      navegador: navigator.userAgent
    });
    // Configuração do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDmmt1wbET6-dcvdsBGXW9j8Pm-S9N4kcs",
      authDomain: "lerning-project-4762d.firebaseapp.com",
      projectId: "lerning-project-4762d",
      storageBucket: "lerning-project-4762d.appspot.com",
      messagingSenderId: "45818309485",
      appId: "1:45818309485:web:e5ef5b9532c6e7d2754864",
      measurementId: "G-6HR53JJSW4"
    };

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // Selecionando os elementos do DOM
    const registerBtn = document.getElementById("registerBtn");
    const backBtn = document.getElementById("backBtn");
    const fullName = document.getElementById("fullName");
    const email = document.getElementById("email");
    const password = document.getElementById("password");
    const confirmPassword = document.getElementById("confirmPassword");
    const alertBox = document.getElementById("alertBox");

    // Função para exibir alertas
    function showAlert(msg, type = "danger") {
      alertBox.style.display = "block";
      alertBox.innerHTML = `
        <div class="alert alert-${type} alert-dismissible fade show" role="alert">
          ${msg}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>`;
    }

    // Evento de clique para registrar o usuário
    registerBtn.addEventListener("click", async () => {
      const name = fullName.value.trim();
      const mail = email.value.trim();
      const pass = password.value.trim();
      const confirm = confirmPassword.value.trim();

      if (!name || !mail || !pass || !confirm) {
        showAlert("Preencha todos os campos!", "warning");
        return;
      }

      if (pass !== confirm) {
        showAlert("As senhas não coincidem!", "danger");
        return;
      }

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, mail, pass);
        await updateProfile(userCredential.user, { displayName: name });
        showAlert("Conta criada com sucesso!", "success");
        setTimeout(() => window.location.href = "login.html", 1500);
      } catch (e) {
        console.error("Erro ao registrar:", e); // Exibe o erro no console
        showAlert("Erro ao registrar: " + e.message, "danger");
      }
    });

    // Evento de clique para voltar ao login
    backBtn.addEventListener("click", () => {
      window.location.href = "login.html";
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>